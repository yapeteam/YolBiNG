package cn.yapeteam.yolbi.module.impl.exploit;

import cn.yapeteam.yolbi.event.Listener;
import cn.yapeteam.yolbi.event.impl.network.EventPacketReceive;
import cn.yapeteam.yolbi.event.impl.network.EventPacketSend;
import cn.yapeteam.yolbi.module.Module;
import cn.yapeteam.yolbi.module.ModuleCategory;
import cn.yapeteam.yolbi.module.ModuleInfo;
import cn.yapeteam.yolbi.values.impl.BooleanValue;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C0APacketAnimation;
import net.minecraft.util.ChatComponentText;

/**
 * @author yuxiangll
 * @package cn.yapeteam.yolbi.module.impl.exploit
 * don't mind
 * @date 2023/9/28 19:46
 */

@ModuleInfo(name = "PacketDebugger", category = ModuleCategory.EXPLOIT)
public class PacketDebugger extends Module {
    private final BooleanValue C0APacketAnimation = new BooleanValue("C0APacketAnimation", false);


    private final BooleanValue C03PacketPlayer = new BooleanValue("C03PacketPlayer", true);
    private final BooleanValue C03PacketPlayerOnGround = new BooleanValue("C03OnGround", C03PacketPlayer::getValue, true);
    private final BooleanValue C03PacketPlayerPos = new BooleanValue("C03Postion", C03PacketPlayer::getValue, true);
    private final BooleanValue C03PacketPlayerMoving = new BooleanValue("C03Moving", C03PacketPlayer::getValue, true);
    private final BooleanValue C03PacketPlayerRotat = new BooleanValue("C03Rotation", C03PacketPlayer::getValue, true);



    public PacketDebugger(){
        this.addValues(
                C0APacketAnimation,
                C03PacketPlayer,C03PacketPlayerOnGround,C03PacketPlayerPos,C03PacketPlayerMoving,C03PacketPlayerRotat);
    }

    @Listener
    protected void onPacketR(EventPacketReceive event) {
        Packet packet = event.getPacket();
        checkAdd(packet);
    }
    @Listener
    protected void onPacketS(EventPacketSend event) {
        Packet packet = event.getPacket();
        checkAdd(packet);
    }


    private void checkAdd(Packet packet){
        if (packet instanceof C03PacketPlayer && C03PacketPlayer.getValue()){
            C03PacketPlayer C03= (C03PacketPlayer) packet;
            if (C03PacketPlayerOnGround.getValue()){
                sendMsg("C03 onGround: "+ C03.isOnGround());
            }
            if (C03PacketPlayerPos.getValue()
                    && (C03.getX()!=0&&C03.getY()!=0&&C03.getZ()!=0)){
                sendMsg("C03 Postion X:"+C03.getX()+" ,Y:"+C03.getY()+" ,Z:"+C03.getZ());
            }
            if (C03PacketPlayerMoving.getValue()){
                sendMsg("C03 Moving: "+ C03.isMoving());
            }
            if (C03PacketPlayerRotat.getValue()
                    && (C03.getYaw() != 0 && C03.getPitch() != 0)){
                sendMsg("C03 Yaw:"+C03.getYaw()+" ,C03 Pitch:"+C03.getPitch());
            }


        }else if (packet instanceof C0APacketAnimation && C03PacketPlayer.getValue()){
        }
    }
    private void sendMsg(String msg){
        mc.thePlayer.addChatMessage(new ChatComponentText(msg));
    }


}
